---
- name: Install Node.js
  ansible.builtin.apt:
    name: nodejs
    state: present
  tags: nodejs
  become: yes

- name: Install npm
  ansible.builtin.apt:
    name: npm
    state: present
  tags: npm
  become: yes

- name: Clone backend repository (shallow clone)
  ansible.builtin.git:
    repo: 'https://github.com/OndiekiFrank/yolo.git'
    dest: /var/www/backend
    depth: 1
  tags: backend
  become: yes

- name: Install backend dependencies
  ansible.builtin.command:
    cmd: npm install
    args:
      chdir: /var/www/backend
  tags: backend
  become: yes

- name: Start backend service
  ansible.builtin.command:
    cmd: npm start
    args:
      chdir: /var/www/backend
  tags: backend
  become: yes
